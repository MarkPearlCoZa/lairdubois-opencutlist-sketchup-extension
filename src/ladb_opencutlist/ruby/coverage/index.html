<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Ruby</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.10.2/application.js' type='text/javascript'></script>    
    <link href='./assets/0.10.2/application.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="./assets/0.10.2/favicon_yellow.png" />
    <link rel="icon" type="image/png" href="./assets/0.10.2/favicon.png" />
  </head>
  
  <body>
    <div id="loading">
      <img src="./assets/0.10.2/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" style="display:none;">
      <div class="timestamp">Generated <abbr class="timeago" title="2020-02-24T19:19:19+13:00">2020-02-24T19:19:19+13:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent"><span class="yellow">84.51%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         464.51
       </span>
    </span> hits/line)
  </h2>
  <a name="AllFiles"></a>
  <div>
    <b>10</b> files in total.
    <b>678</b> relevant lines. 
    <span class="green"><b>573</b> lines covered</span> and
    <span class="red"><b>105</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#08554a8028807f0bfe0a57d3a554fdc9d014105b" class="src_link" title="constants.rb">constants.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>7</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ad882fbd66b62fd0271dbef9f33ebe6c4a69e8b8" class="src_link" title="lib/bin_packing_2d/bin.rb">lib/bin_packing_2d/bin.rb</a></td>
        <td class="yellow strong">85.19 %</td>
        <td>320</td>
        <td>162</td>
        <td>138</td>
        <td>24</td>
        <td>671.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#dc5486a9de89e9ea29b1397c227c191c4c9f0828" class="src_link" title="lib/bin_packing_2d/box.rb">lib/bin_packing_2d/box.rb</a></td>
        <td class="red strong">77.42 %</td>
        <td>119</td>
        <td>62</td>
        <td>48</td>
        <td>14</td>
        <td>226.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5f9ca646b6e68974f2cd43cd3de369e77b6f1aac" class="src_link" title="lib/bin_packing_2d/cut.rb">lib/bin_packing_2d/cut.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>27</td>
        <td>15</td>
        <td>15</td>
        <td>0</td>
        <td>1382.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#cd17ee7063dc42529d0f17324dc96eeb1ba1243f" class="src_link" title="lib/bin_packing_2d/options.rb">lib/bin_packing_2d/options.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>21</td>
        <td>13</td>
        <td>13</td>
        <td>0</td>
        <td>4.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7a1213086749013bea73b81b1da88cc434f77a0e" class="src_link" title="lib/bin_packing_2d/packengine.rb">lib/bin_packing_2d/packengine.rb</a></td>
        <td class="green strong">98.0 %</td>
        <td>88</td>
        <td>50</td>
        <td>49</td>
        <td>1</td>
        <td>265.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6c8c62bbed178c84f6dec3fd5539b72f1c17c046" class="src_link" title="lib/bin_packing_2d/packer.rb">lib/bin_packing_2d/packer.rb</a></td>
        <td class="yellow strong">82.93 %</td>
        <td>466</td>
        <td>246</td>
        <td>204</td>
        <td>42</td>
        <td>428.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d1cab849a47dbfae94082aaede1f7fdf9beefaa9" class="src_link" title="lib/bin_packing_2d/packing2d.rb">lib/bin_packing_2d/packing2d.rb</a></td>
        <td class="red strong">66.04 %</td>
        <td>83</td>
        <td>53</td>
        <td>35</td>
        <td>18</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f5a1707d56acd81036d89b2859dcd98f6b3a78ab" class="src_link" title="lib/bin_packing_2d/performance.rb">lib/bin_packing_2d/performance.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>18</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>410.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b8afc62a37a01fcc46368eb0f3e0c8d4b9529fbf" class="src_link" title="lib/bin_packing_2d/score.rb">lib/bin_packing_2d/score.rb</a></td>
        <td class="green strong">90.48 %</td>
        <td>106</td>
        <td>63</td>
        <td>57</td>
        <td>6</td>
        <td>768.5</td>
      </tr>
      
    </tbody>
  </table>
</div>


        
      </div>
    
      <div id="footer">
        Generated by <a href="http://github.com/colszowka/simplecov">simplecov</a> v0.17.1 
        and simplecov-html v0.10.2<br/>
        using RSpec
      </div>
    
      <div class="source_files">
      
        <div class="source_table" id="08554a8028807f0bfe0a57d3a554fdc9d014105b">
  <div class="header">
    <h3>constants.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Ladb::OpenCutList</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    EXTENSION_NAME = &#39;OpenCutList&#39;.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    EXTENSION_VERSION = &#39;1.6.0&#39;.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    EXTENSION_BUILD = &#39;201902111715&#39;.freeze</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="ad882fbd66b62fd0271dbef9f33ebe6c4a69e8b8">
  <div class="header">
    <h3>lib/bin_packing_2d/bin.rb</h3>
    <h4><span class="yellow">85.19 %</span> covered</h4>
    <div>
      <b>162</b> relevant lines. 
      <span class="green"><b>138</b> lines covered</span> and
      <span class="red"><b>24</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Ladb::OpenCutList::BinPacking2D</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  # This class has two purposes:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # 1. it represents a single bin object that knows how to split itself</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # 2. it is a placeholder for placed boxes/cuts.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  class Bin &lt; Packing2D</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_accessor :boxes, :cuts, :leftovers, :length, :width, :x, :y, :length_cuts, :trimmed, :trimsize, :index, :type</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader :efficiency, :total_length_cuts</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(length, width, x, y, index, type)</code>
        </li>
      
        <li class="covered" data-hits="2613" data-linenumber="15">
          <span class="hits">2613</span>
          
          <code class="ruby">      @length = length</code>
        </li>
      
        <li class="covered" data-hits="2613" data-linenumber="16">
          <span class="hits">2613</span>
          
          <code class="ruby">      @width = width</code>
        </li>
      
        <li class="covered" data-hits="2613" data-linenumber="17">
          <span class="hits">2613</span>
          
          <code class="ruby">      @index = index</code>
        </li>
      
        <li class="covered" data-hits="2613" data-linenumber="18">
          <span class="hits">2613</span>
          
          <code class="ruby">      @type = type</code>
        </li>
      
        <li class="covered" data-hits="2613" data-linenumber="19">
          <span class="hits">2613</span>
          
          <code class="ruby">      @x = x</code>
        </li>
      
        <li class="covered" data-hits="2613" data-linenumber="20">
          <span class="hits">2613</span>
          
          <code class="ruby">      @y = y</code>
        </li>
      
        <li class="covered" data-hits="2613" data-linenumber="21">
          <span class="hits">2613</span>
          
          <code class="ruby">      @max_x = 0</code>
        </li>
      
        <li class="covered" data-hits="2613" data-linenumber="22">
          <span class="hits">2613</span>
          
          <code class="ruby">      @max_y = 0</code>
        </li>
      
        <li class="covered" data-hits="2613" data-linenumber="23">
          <span class="hits">2613</span>
          
          <code class="ruby">      @boxes = []</code>
        </li>
      
        <li class="covered" data-hits="2613" data-linenumber="24">
          <span class="hits">2613</span>
          
          <code class="ruby">      @cuts = []</code>
        </li>
      
        <li class="covered" data-hits="2613" data-linenumber="25">
          <span class="hits">2613</span>
          
          <code class="ruby">      @total_length_cuts = 0</code>
        </li>
      
        <li class="covered" data-hits="2613" data-linenumber="26">
          <span class="hits">2613</span>
          
          <code class="ruby">      @efficiency = 0</code>
        </li>
      
        <li class="covered" data-hits="2613" data-linenumber="27">
          <span class="hits">2613</span>
          
          <code class="ruby">      @leftovers = []</code>
        </li>
      
        <li class="covered" data-hits="2613" data-linenumber="28">
          <span class="hits">2613</span>
          
          <code class="ruby">      @trimmed = false</code>
        </li>
      
        <li class="covered" data-hits="2613" data-linenumber="29">
          <span class="hits">2613</span>
          
          <code class="ruby">      @trimsize = 0</code>
        </li>
      
        <li class="covered" data-hits="2613" data-linenumber="30">
          <span class="hits">2613</span>
          
          <code class="ruby">      @bbox_done = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_copy</code>
        </li>
      
        <li class="covered" data-hits="1008" data-linenumber="34">
          <span class="hits">1008</span>
          
          <code class="ruby">      b = Bin.new(@length, @width, @x, @y, @index, @type)</code>
        </li>
      
        <li class="covered" data-hits="1008" data-linenumber="35">
          <span class="hits">1008</span>
          
          <code class="ruby">      b.trimmed = @trimmed</code>
        </li>
      
        <li class="covered" data-hits="1008" data-linenumber="36">
          <span class="hits">1008</span>
          
          <code class="ruby">      b.trimsize = @trimsize</code>
        </li>
      
        <li class="covered" data-hits="1008" data-linenumber="37">
          <span class="hits">1008</span>
          
          <code class="ruby">      return b</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    # Trim the bin&#39;s all four edges by trimsize, not recording</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    # the cuts.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    # The trimming is usually necessary on sheet good to get</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    # a clean edge.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">    def trim_rough_bin(trimsize)</code>
        </li>
      
        <li class="covered" data-hits="1008" data-linenumber="46">
          <span class="hits">1008</span>
          
          <code class="ruby">      if trimsize &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="864" data-linenumber="47">
          <span class="hits">864</span>
          
          <code class="ruby">        @trimsize = trimsize</code>
        </li>
      
        <li class="covered" data-hits="864" data-linenumber="48">
          <span class="hits">864</span>
          
          <code class="ruby">        @length = @length - 2 * @trimsize</code>
        </li>
      
        <li class="covered" data-hits="864" data-linenumber="49">
          <span class="hits">864</span>
          
          <code class="ruby">        @width = @width - 2 * @trimsize</code>
        </li>
      
        <li class="covered" data-hits="864" data-linenumber="50">
          <span class="hits">864</span>
          
          <code class="ruby">        @x = @trimsize</code>
        </li>
      
        <li class="covered" data-hits="864" data-linenumber="51">
          <span class="hits">864</span>
          
          <code class="ruby">        @y = @trimsize</code>
        </li>
      
        <li class="covered" data-hits="864" data-linenumber="52">
          <span class="hits">864</span>
          
          <code class="ruby">        @cleaned = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    # Split the bin vertically at v considering the saw_kerf.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    # Creates and returns a sl = left bin and sr = right bin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">    def split_vertically(v, saw_kerf)</code>
        </li>
      
        <li class="covered" data-hits="882" data-linenumber="60">
          <span class="hits">882</span>
          
          <code class="ruby">      sl = self.clone</code>
        </li>
      
        <li class="covered" data-hits="882" data-linenumber="61">
          <span class="hits">882</span>
          
          <code class="ruby">      sl.length = v</code>
        </li>
      
        <li class="covered" data-hits="882" data-linenumber="62">
          <span class="hits">882</span>
          
          <code class="ruby">      sr = self.clone</code>
        </li>
      
        <li class="covered" data-hits="882" data-linenumber="63">
          <span class="hits">882</span>
          
          <code class="ruby">      if @length &gt; v</code>
        </li>
      
        <li class="covered" data-hits="882" data-linenumber="64">
          <span class="hits">882</span>
          
          <code class="ruby">        sr.length -= v + saw_kerf</code>
        </li>
      
        <li class="covered" data-hits="882" data-linenumber="65">
          <span class="hits">882</span>
          
          <code class="ruby">        sr.x += v + saw_kerf</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">        sr.length = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="68">
          
          
          <code class="ruby">        sr.width = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="69">
          
          
          <code class="ruby">        sr.x += v + saw_kerf</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="882" data-linenumber="71">
          <span class="hits">882</span>
          
          <code class="ruby">      return sl, sr</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    # Split the bin bin horizontally at h considering the saw_kerf.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    # Creates and returns a st = top bin and sb = bottom bin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">    def split_horizontally(h, saw_kerf)</code>
        </li>
      
        <li class="covered" data-hits="810" data-linenumber="78">
          <span class="hits">810</span>
          
          <code class="ruby">      st = self.clone</code>
        </li>
      
        <li class="covered" data-hits="810" data-linenumber="79">
          <span class="hits">810</span>
          
          <code class="ruby">      st.width = h</code>
        </li>
      
        <li class="covered" data-hits="810" data-linenumber="80">
          <span class="hits">810</span>
          
          <code class="ruby">      sb = self.clone</code>
        </li>
      
        <li class="covered" data-hits="810" data-linenumber="81">
          <span class="hits">810</span>
          
          <code class="ruby">      if @width &gt; h</code>
        </li>
      
        <li class="covered" data-hits="810" data-linenumber="82">
          <span class="hits">810</span>
          
          <code class="ruby">        sb.width -= h + saw_kerf</code>
        </li>
      
        <li class="covered" data-hits="810" data-linenumber="83">
          <span class="hits">810</span>
          
          <code class="ruby">        sb.y += h + saw_kerf</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="85">
          
          
          <code class="ruby">        sb.length = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="86">
          
          
          <code class="ruby">        sb.width = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="87">
          
          
          <code class="ruby">        s.y += h + saw_kerf</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="810" data-linenumber="89">
          <span class="hits">810</span>
          
          <code class="ruby">      return st, sb</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">    # Returns whether the bin should be split horizontally/vertically</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">    # or vertically/horizontally.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">    # The result depends on the split heuristic.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">    def split_horizontally_first?(box, split)</code>
        </li>
      
        <li class="covered" data-hits="972" data-linenumber="97">
          <span class="hits">972</span>
          
          <code class="ruby">      w = @width - box.width</code>
        </li>
      
        <li class="covered" data-hits="972" data-linenumber="98">
          <span class="hits">972</span>
          
          <code class="ruby">      l = @length - box.length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="972" data-linenumber="100">
          <span class="hits">972</span>
          
          <code class="ruby">      case split</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">      when SPLIT_SHORTERLEFTOVER_AXIS</code>
        </li>
      
        <li class="covered" data-hits="162" data-linenumber="102">
          <span class="hits">162</span>
          
          <code class="ruby">        decision = (w &lt;= l)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">      when SPLIT_LONGERLEFTOVER_AXIS</code>
        </li>
      
        <li class="covered" data-hits="162" data-linenumber="104">
          <span class="hits">162</span>
          
          <code class="ruby">        decision = (w &gt; l)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">      when SPLIT_MINIMIZE_AREA</code>
        </li>
      
        <li class="covered" data-hits="162" data-linenumber="106">
          <span class="hits">162</span>
          
          <code class="ruby">        decision = (l * box.width &gt; box.length * w)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">      when SPLIT_MAXIMIZE_AREA</code>
        </li>
      
        <li class="covered" data-hits="162" data-linenumber="108">
          <span class="hits">162</span>
          
          <code class="ruby">        decision = (l * box.width &lt;= box.length * w)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">      when SPLIT_SHORTER_AXIS</code>
        </li>
      
        <li class="covered" data-hits="162" data-linenumber="110">
          <span class="hits">162</span>
          
          <code class="ruby">        decision = (@length &lt;= @width)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">      when SPLIT_LONGER_AXIS</code>
        </li>
      
        <li class="covered" data-hits="162" data-linenumber="112">
          <span class="hits">162</span>
          
          <code class="ruby">        decision = (@length &gt; @width)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="114">
          
          
          <code class="ruby">        decision = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="972" data-linenumber="117">
          <span class="hits">972</span>
          
          <code class="ruby">      return decision</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">    # Computes whether a given box fits</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">    def encloses?(box)</code>
        </li>
      
        <li class="covered" data-hits="3888" data-linenumber="123">
          <span class="hits">3888</span>
          
          <code class="ruby">      return (@length &gt;= box.length &amp;&amp; @width &gt;= box.width)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">    # Computes whether a given &quot;rotated&quot; box will fit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">    # into this bin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">    def encloses_rotated?(box)</code>
        </li>
      
        <li class="covered" data-hits="2340" data-linenumber="130">
          <span class="hits">2340</span>
          
          <code class="ruby">      return @length &gt;= box.width &amp;&amp; @width &gt;= box.length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">    # Adds a box to the bin once it was placed</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">    def add_box(box)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">      # keep track of bounding box lower right corner</code>
        </li>
      
        <li class="covered" data-hits="972" data-linenumber="137">
          <span class="hits">972</span>
          
          <code class="ruby">      @max_x = [@max_x, box.x + box.length].max</code>
        </li>
      
        <li class="covered" data-hits="972" data-linenumber="138">
          <span class="hits">972</span>
          
          <code class="ruby">      @max_y = [@max_y, box.y + box.width].max</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">      # mark bounding box as dirty</code>
        </li>
      
        <li class="covered" data-hits="972" data-linenumber="140">
          <span class="hits">972</span>
          
          <code class="ruby">      @bbox_done = false</code>
        </li>
      
        <li class="covered" data-hits="972" data-linenumber="141">
          <span class="hits">972</span>
          
          <code class="ruby">      @boxes &lt;&lt; box</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">    # Adds a cut to this bin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">    def add_cut(cut)</code>
        </li>
      
        <li class="covered" data-hits="2592" data-linenumber="147">
          <span class="hits">2592</span>
          
          <code class="ruby">      @cuts &lt;&lt; cut</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">    # Crop a bin to a smaller size. Used by the bounding box part</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">    # of the algorithm in packer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="153">
          <span class="hits">1</span>
          
          <code class="ruby">    def crop(max_x, max_y)</code>
        </li>
      
        <li class="covered" data-hits="648" data-linenumber="154">
          <span class="hits">648</span>
          
          <code class="ruby">      if @x + @length &gt; max_x</code>
        </li>
      
        <li class="covered" data-hits="468" data-linenumber="155">
          <span class="hits">468</span>
          
          <code class="ruby">        @length = max_x - @x</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="648" data-linenumber="157">
          <span class="hits">648</span>
          
          <code class="ruby">      if @y + @width &gt; max_y</code>
        </li>
      
        <li class="covered" data-hits="468" data-linenumber="158">
          <span class="hits">468</span>
          
          <code class="ruby">        @width = max_y - @y</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">    # Crop all leftovers to the bounding box of all packed boxes, add</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">    # necessary cuts and new leftovers.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">    # This function assumes that leftovers have been assigned correctly</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">    # to the bin prior to calling it.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">    def crop_to_bounding_box(saw_kerf, box)</code>
        </li>
      
        <li class="covered" data-hits="828" data-linenumber="168">
          <span class="hits">828</span>
          
          <code class="ruby">      unless @bbox_done</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">        # trim all cuts that go beyond max_y and max_y</code>
        </li>
      
        <li class="covered" data-hits="324" data-linenumber="170">
          <span class="hits">324</span>
          
          <code class="ruby">        @cuts.each do |cut|</code>
        </li>
      
        <li class="covered" data-hits="936" data-linenumber="171">
          <span class="hits">936</span>
          
          <code class="ruby">          if cut.is_horizontal &amp;&amp; cut.x + cut.length &gt; @max_x</code>
        </li>
      
        <li class="covered" data-hits="144" data-linenumber="172">
          <span class="hits">144</span>
          
          <code class="ruby">            cut.length = @max_x - cut.x</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="936" data-linenumber="174">
          <span class="hits">936</span>
          
          <code class="ruby">          if !cut.is_horizontal &amp;&amp; cut.y + cut.length &gt; @max_y</code>
        </li>
      
        <li class="covered" data-hits="180" data-linenumber="175">
          <span class="hits">180</span>
          
          <code class="ruby">            cut.length = @max_y - cut.y</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="324" data-linenumber="179">
          <span class="hits">324</span>
          
          <code class="ruby">        leftovers = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="324" data-linenumber="181">
          <span class="hits">324</span>
          
          <code class="ruby">        sr = (@length - 2 * @trimsize - @max_x) * @width</code>
        </li>
      
        <li class="covered" data-hits="324" data-linenumber="182">
          <span class="hits">324</span>
          
          <code class="ruby">        sb = @length * (@width - 2 * @trimsize - @max_y)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="324" data-linenumber="184">
          <span class="hits">324</span>
          
          <code class="ruby">        cut_horizontal = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="324" data-linenumber="186">
          <span class="hits">324</span>
          
          <code class="ruby">        if !box.nil?</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="187">
          <span class="hits">72</span>
          
          <code class="ruby">          if box.length &lt;= @length &amp;&amp; box.width &lt;= (@width - 2 * @trimsize - @max_y)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">            # cut first horizontal</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="189">
          
          
          <code class="ruby">            cut_horizontal = true</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="190">
          <span class="hits">72</span>
          
          <code class="ruby">          elsif box.length &lt;= (@width - 2 * @trimsize - @max_y) &amp;&amp; box.width &lt; @width</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">            # cut first vertical</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="192">
          <span class="hits">36</span>
          
          <code class="ruby">            cut_horizontal = false</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="193">
          <span class="hits">36</span>
          
          <code class="ruby">          elsif sb &gt;= sr</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">            # cut first horizontal</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="195">
          
          
          <code class="ruby">            cut_horizontal = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="197">
          <span class="hits">36</span>
          
          <code class="ruby">            cut_horizontal = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="199">
          <span class="hits">252</span>
          
          <code class="ruby">        elsif sb &gt;= sr</code>
        </li>
      
        <li class="covered" data-hits="54" data-linenumber="200">
          <span class="hits">54</span>
          
          <code class="ruby">          cut_horizontal = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">          # FIXME in 1.5.1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">          # cut_horizontal = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">          # this seems to exhibit some strange behaviour!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">          # the idea is that we perform the bounding box by increasing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby">          # the area of the larger of the two leftovers, but this tends</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">          # to break the selection of the best packing in packengine</code>
        </li>
      
        <li class="covered" data-hits="198" data-linenumber="208">
          <span class="hits">198</span>
          
          <code class="ruby">          cut_horizontal = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">         end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby">        # Pick the cut sequence that will maximize area of larger leftover area.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby">        # Probably needs to follow split strategy using score object, maybe later.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="213">
          
          
          <code class="ruby">        #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="214">
          
          
          <code class="ruby">        # This may also lead to degenerate pieces, will have to fix them in packer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby">        #</code>
        </li>
      
        <li class="covered" data-hits="324" data-linenumber="216">
          <span class="hits">324</span>
          
          <code class="ruby">        if cut_horizontal</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby">          # add a new horizontal cut and make a new bottom leftover</code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="218">
          <span class="hits">252</span>
          
          <code class="ruby">          if @max_y &lt;= @width</code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="219">
          <span class="hits">252</span>
          
          <code class="ruby">            c = Cut.new(@x + @trimsize, @max_y, @length - 2 * @trimsize, true)</code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="220">
          <span class="hits">252</span>
          
          <code class="ruby">            hl = Bin.new(@length - 2 * @trimsize, @width - @max_y - saw_kerf - @trimsize,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">                                       @x + @trimsize, @max_y + saw_kerf, @index, @type)</code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="222">
          <span class="hits">252</span>
          
          <code class="ruby">            add_cut(c)</code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="223">
          <span class="hits">252</span>
          
          <code class="ruby">            leftovers &lt;&lt; hl if hl.length &gt; 0 &amp;&amp; hl.width &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby">          # add a new vertical cut and make a new right side vertical leftover</code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="226">
          <span class="hits">252</span>
          
          <code class="ruby">          if @max_x &lt;= @length</code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="227">
          <span class="hits">252</span>
          
          <code class="ruby">            c = Cut.new(@max_x, @y + @trimsize, @max_y - @trimsize, false)</code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="228">
          <span class="hits">252</span>
          
          <code class="ruby">            vl = Bin.new(@length - @max_x - @trimsize - saw_kerf, @max_y - @trimsize,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="229">
          
          
          <code class="ruby">                                       @max_x + saw_kerf, @y + @trimsize, @index, @type)</code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="230">
          <span class="hits">252</span>
          
          <code class="ruby">            add_cut(c)</code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="231">
          <span class="hits">252</span>
          
          <code class="ruby">            leftovers &lt;&lt; vl if vl.length &gt; 0 &amp;&amp; vl.width &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">          # add a new vertical cut and make a new right side vertical leftover</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="235">
          <span class="hits">72</span>
          
          <code class="ruby">          if @max_x &lt;= @length</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="236">
          <span class="hits">72</span>
          
          <code class="ruby">            c = Cut.new(@max_x, @y + @trimsize, @width - 2 * @trimsize, false)</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="237">
          <span class="hits">72</span>
          
          <code class="ruby">            vl = Bin.new(@length - @max_x - @trimsize - saw_kerf, @width - 2 * @trimsize,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby">                                       @max_x + saw_kerf, @y + @trimsize, @index, @type)</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="239">
          <span class="hits">72</span>
          
          <code class="ruby">            add_cut(c)</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="240">
          <span class="hits">72</span>
          
          <code class="ruby">            leftovers &lt;&lt; vl if vl.length &gt; 0 &amp;&amp; vl.width &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="242">
          <span class="hits">72</span>
          
          <code class="ruby">          if @max_y &lt;= @width</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="243">
          <span class="hits">72</span>
          
          <code class="ruby">            c = Cut.new(@x + @trimsize, @max_y, @max_x - @trimsize, true)</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="244">
          <span class="hits">72</span>
          
          <code class="ruby">            hl = Bin.new(@max_x - @trimsize, @width - @max_y - saw_kerf - @trimsize,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="245">
          
          
          <code class="ruby">                                       @x + @trimsize, @max_y + saw_kerf, @index, @type)</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="246">
          <span class="hits">72</span>
          
          <code class="ruby">            add_cut(c)</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="247">
          <span class="hits">72</span>
          
          <code class="ruby">            leftovers &lt;&lt; hl if hl.length &gt; 0 &amp;&amp; hl.width &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">        # crop the leftovers to the bounding box</code>
        </li>
      
        <li class="covered" data-hits="324" data-linenumber="252">
          <span class="hits">324</span>
          
          <code class="ruby">        @leftovers.each do |b|</code>
        </li>
      
        <li class="covered" data-hits="648" data-linenumber="253">
          <span class="hits">648</span>
          
          <code class="ruby">          b.crop(@max_x, @max_y)</code>
        </li>
      
        <li class="covered" data-hits="648" data-linenumber="254">
          <span class="hits">648</span>
          
          <code class="ruby">          if b.length &gt; 0 &amp;&amp; b.width &gt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="255">
          
          
          <code class="ruby">            leftovers &lt;&lt; b</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="324" data-linenumber="258">
          <span class="hits">324</span>
          
          <code class="ruby">        @leftovers = leftovers</code>
        </li>
      
        <li class="covered" data-hits="324" data-linenumber="259">
          <span class="hits">324</span>
          
          <code class="ruby">        @bbox_done = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="260">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="261">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="262">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="263">
          
          
          <code class="ruby">    # Returns percentage of coverage by boxes not including</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">    # waste area from saw_kerf</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="266">
          <span class="hits">1</span>
          
          <code class="ruby">    def compute_efficiency</code>
        </li>
      
        <li class="covered" data-hits="720" data-linenumber="267">
          <span class="hits">720</span>
          
          <code class="ruby">      boxes_area = 0</code>
        </li>
      
        <li class="covered" data-hits="1944" data-linenumber="268">
          <span class="hits">1944</span>
          
          <code class="ruby">      @boxes.each { |box| boxes_area += box.area }</code>
        </li>
      
        <li class="covered" data-hits="720" data-linenumber="269">
          <span class="hits">720</span>
          
          <code class="ruby">      @efficiency = boxes_area * 100.0 / area</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="270">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="271">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby">    # Returns total horizontal and vertical cut lengths</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="273">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="274">
          <span class="hits">1</span>
          
          <code class="ruby">    def total_cutlengths</code>
        </li>
      
        <li class="covered" data-hits="720" data-linenumber="275">
          <span class="hits">720</span>
          
          <code class="ruby">      h_cuts = 0</code>
        </li>
      
        <li class="covered" data-hits="720" data-linenumber="276">
          <span class="hits">720</span>
          
          <code class="ruby">      v_cuts = 0</code>
        </li>
      
        <li class="covered" data-hits="720" data-linenumber="277">
          <span class="hits">720</span>
          
          <code class="ruby">      @cuts.each do |cut|</code>
        </li>
      
        <li class="covered" data-hits="2592" data-linenumber="278">
          <span class="hits">2592</span>
          
          <code class="ruby">        h_cuts += cut.get_h_cutlength()</code>
        </li>
      
        <li class="covered" data-hits="2592" data-linenumber="279">
          <span class="hits">2592</span>
          
          <code class="ruby">        v_cuts += cut.get_v_cutlength()</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="720" data-linenumber="281">
          <span class="hits">720</span>
          
          <code class="ruby">      @total_length_cuts = h_cuts + v_cuts</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby">    # Returns total horizontal and vertical length of</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby">    # contained boxes.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="286">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="287">
          <span class="hits">1</span>
          
          <code class="ruby">    def total_boxlengths</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="288">
          
          
          <code class="ruby">      h = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="289">
          
          
          <code class="ruby">      v = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="290">
          
          
          <code class="ruby">      @boxes.each do |box|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="291">
          
          
          <code class="ruby">        h += box.length</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="292">
          
          
          <code class="ruby">        v += box.width</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="294">
          
          
          <code class="ruby">      return h, v</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="296">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="297">
          
          
          <code class="ruby">    # Returns the largest leftover bin in this bin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="298">
          
          
          <code class="ruby">    # Assumes that leftovers have already been assigned</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="299">
          
          
          <code class="ruby">    # to this bin.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="300">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="301">
          <span class="hits">1</span>
          
          <code class="ruby">    def largest_leftover</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="302">
          
          
          <code class="ruby">      largest_bin = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="303">
          
          
          <code class="ruby">      largest_area = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="304">
          
          
          <code class="ruby">      @leftovers.each do |b|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="305">
          
          
          <code class="ruby">        a = b.area</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="306">
          
          
          <code class="ruby">        if a &gt; largest_area</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="307">
          
          
          <code class="ruby">          largest_bin = b</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="308">
          
          
          <code class="ruby">          largest_area = a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="309">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="310">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="311">
          
          
          <code class="ruby">      return largest_bin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="312">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="313">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">    def area</code>
        </li>
      
        <li class="covered" data-hits="2124" data-linenumber="315">
          <span class="hits">2124</span>
          
          <code class="ruby">      return @length * @width</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="318">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="319">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="320">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="dc5486a9de89e9ea29b1397c227c191c4c9f0828">
  <div class="header">
    <h3>lib/bin_packing_2d/box.rb</h3>
    <h4><span class="red">77.42 %</span> covered</h4>
    <div>
      <b>62</b> relevant lines. 
      <span class="green"><b>48</b> lines covered</span> and
      <span class="red"><b>14</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Ladb::OpenCutList::BinPacking2D</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  class Box &lt; Packing2D</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader :length, :width, :x, :y, :rotated, :data, :sboxes, :is_superbox</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(length, width, data = nil)</code>
        </li>
      
        <li class="covered" data-hits="358" data-linenumber="8">
          <span class="hits">358</span>
          
          <code class="ruby">      @length = length</code>
        </li>
      
        <li class="covered" data-hits="358" data-linenumber="9">
          <span class="hits">358</span>
          
          <code class="ruby">      @width = width</code>
        </li>
      
        <li class="covered" data-hits="358" data-linenumber="10">
          <span class="hits">358</span>
          
          <code class="ruby">      @x = 0</code>
        </li>
      
        <li class="covered" data-hits="358" data-linenumber="11">
          <span class="hits">358</span>
          
          <code class="ruby">      @y = 0</code>
        </li>
      
        <li class="covered" data-hits="358" data-linenumber="12">
          <span class="hits">358</span>
          
          <code class="ruby">      @rotated = false</code>
        </li>
      
        <li class="covered" data-hits="358" data-linenumber="13">
          <span class="hits">358</span>
          
          <code class="ruby">      @data = data</code>
        </li>
      
        <li class="covered" data-hits="358" data-linenumber="14">
          <span class="hits">358</span>
          
          <code class="ruby">      @sboxes = []</code>
        </li>
      
        <li class="covered" data-hits="358" data-linenumber="15">
          <span class="hits">358</span>
          
          <code class="ruby">      @is_superbox = false</code>
        </li>
      
        <li class="covered" data-hits="358" data-linenumber="16">
          <span class="hits">358</span>
          
          <code class="ruby">      @stack_is_horizontal = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    # Sets the position and the index of a box</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    # called when placed in packer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_position(x, y)</code>
        </li>
      
        <li class="covered" data-hits="1476" data-linenumber="23">
          <span class="hits">1476</span>
          
          <code class="ruby">      @x = x</code>
        </li>
      
        <li class="covered" data-hits="1476" data-linenumber="24">
          <span class="hits">1476</span>
          
          <code class="ruby">      @y = y</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    # Stack box horizontally. The container box is the bounding</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    # box of the contained boxes in @sboxes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    def stack_length(box, saw_kerf, max)</code>
        </li>
      
        <li class="covered" data-hits="576" data-linenumber="31">
          <span class="hits">576</span>
          
          <code class="ruby">      return false if box.width != @width</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="576" data-linenumber="33">
          <span class="hits">576</span>
          
          <code class="ruby">      if box.length + @length &gt; max</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">        return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="576" data-linenumber="36">
          <span class="hits">576</span>
          
          <code class="ruby">        @length += saw_kerf if @length &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="576" data-linenumber="37">
          <span class="hits">576</span>
          
          <code class="ruby">        @length += box.length</code>
        </li>
      
        <li class="covered" data-hits="576" data-linenumber="38">
          <span class="hits">576</span>
          
          <code class="ruby">        @sboxes &lt;&lt; box</code>
        </li>
      
        <li class="covered" data-hits="576" data-linenumber="39">
          <span class="hits">576</span>
          
          <code class="ruby">        @is_superbox = true</code>
        </li>
      
        <li class="covered" data-hits="576" data-linenumber="40">
          <span class="hits">576</span>
          
          <code class="ruby">        return true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    # Stack box vertically. The container box is the bounding</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    # box of the contained boxes in @sboxes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    def stack_width(box, saw_kerf, max)</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="48">
          <span class="hits">72</span>
          
          <code class="ruby">      return false if box.length != @length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="50">
          <span class="hits">72</span>
          
          <code class="ruby">      if box.width + @width &gt; max</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">        return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="53">
          <span class="hits">72</span>
          
          <code class="ruby">        @width += saw_kerf if @width &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="54">
          <span class="hits">72</span>
          
          <code class="ruby">        @width += box.width</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="55">
          <span class="hits">72</span>
          
          <code class="ruby">        @sboxes &lt;&lt; box</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="56">
          <span class="hits">72</span>
          
          <code class="ruby">        @is_superbox = true</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="57">
          <span class="hits">72</span>
          
          <code class="ruby">        @stack_is_horizontal = false</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="58">
          <span class="hits">72</span>
          
          <code class="ruby">        return true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">    # Break up a superbox into array of contained boxes. </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">    # When called, we know that we are a a superbox, no need to check</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">    def break_up_supergroup</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="66">
          <span class="hits">72</span>
          
          <code class="ruby">      boxes = []</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="67">
          <span class="hits">72</span>
          
          <code class="ruby">      @sboxes.each do |box|</code>
        </li>
      
        <li class="covered" data-hits="144" data-linenumber="68">
          <span class="hits">144</span>
          
          <code class="ruby">        boxes &lt;&lt; box</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="70">
          <span class="hits">72</span>
          
          <code class="ruby">      return boxes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">    # Reduce the size of a supergroup. If it contains more than</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    # 2 elements, remove just the last one. </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    # When called, we know that we are a a superbox, no need to check</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">    def reduce_supergroup(saw_kerf)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="78">
          
          
          <code class="ruby">      boxes = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="79">
          
          
          <code class="ruby">      if @sboxes.length() &gt; 2</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="80">
          
          
          <code class="ruby">        *@sboxes, last = @sboxes</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="81">
          
          
          <code class="ruby">        if @stack_is_horizontal</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="82">
          
          
          <code class="ruby">          @length = @length - last.length - saw_kerf</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="84">
          
          
          <code class="ruby">          @width = @width - last.width - saw_kerf</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="86">
          
          
          <code class="ruby">        boxes.unshift(last)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="87">
          
          
          <code class="ruby">        boxes.unshift(self) # we are still a valid superbox</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="89">
          
          
          <code class="ruby">        @sboxes.each do |box|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="90">
          
          
          <code class="ruby">          boxes.unshift(box)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="93">
          
          
          <code class="ruby">      return boxes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">    def area</code>
        </li>
      
        <li class="covered" data-hits="1224" data-linenumber="97">
          <span class="hits">1224</span>
          
          <code class="ruby">      return @length * @width</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">    # Rotate the box, used when grain direction does not matter</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">    def rotate</code>
        </li>
      
        <li class="covered" data-hits="486" data-linenumber="103">
          <span class="hits">486</span>
          
          <code class="ruby">      @width, @length = [@length, @width]</code>
        </li>
      
        <li class="covered" data-hits="486" data-linenumber="104">
          <span class="hits">486</span>
          
          <code class="ruby">      @rotated = !@rotated</code>
        </li>
      
        <li class="covered" data-hits="486" data-linenumber="105">
          <span class="hits">486</span>
          
          <code class="ruby">      return self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">    # Returns if box has been rotated</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">    def rotated?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="111">
          
          
          <code class="ruby">      return @rotated</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">    # Returns if a box will fit a bin that has not yet been created</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">    def fits_into_bin?(length, width, trimsize, rotatable)</code>
        </li>
      
        <li class="covered" data-hits="216" data-linenumber="116">
          <span class="hits">216</span>
          
          <code class="ruby">      (@length &lt;= length - 2 * trimsize &amp;&amp; @width &lt;= width - 2 * trimsize) || (@rotatable and @length &lt;= width - 2 * trimsize &amp;&amp; @width &lt;= length - 2 * trimsize)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="5f9ca646b6e68974f2cd43cd3de369e77b6f1aac">
  <div class="header">
    <h3>lib/bin_packing_2d/cut.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>15</b> relevant lines. 
      <span class="green"><b>15</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Ladb::OpenCutList::BinPacking2D</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  class Cut &lt; Packing2D</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_accessor :x, :y, :length, :width, :is_horizontal, :is_primary</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(x, y, length, is_horizontal, is_primary = true)</code>
        </li>
      
        <li class="covered" data-hits="2592" data-linenumber="8">
          <span class="hits">2592</span>
          
          <code class="ruby">      @x = x</code>
        </li>
      
        <li class="covered" data-hits="2592" data-linenumber="9">
          <span class="hits">2592</span>
          
          <code class="ruby">      @y = y</code>
        </li>
      
        <li class="covered" data-hits="2592" data-linenumber="10">
          <span class="hits">2592</span>
          
          <code class="ruby">      @length = length</code>
        </li>
      
        <li class="covered" data-hits="2592" data-linenumber="11">
          <span class="hits">2592</span>
          
          <code class="ruby">      @is_primary = is_primary</code>
        </li>
      
        <li class="covered" data-hits="2592" data-linenumber="12">
          <span class="hits">2592</span>
          
          <code class="ruby">      @is_horizontal = is_horizontal</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_v_cutlength</code>
        </li>
      
        <li class="covered" data-hits="2592" data-linenumber="16">
          <span class="hits">2592</span>
          
          <code class="ruby">      return length if !@is_horizontal</code>
        </li>
      
        <li class="covered" data-hits="1134" data-linenumber="17">
          <span class="hits">1134</span>
          
          <code class="ruby">      return 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_h_cutlength</code>
        </li>
      
        <li class="covered" data-hits="2592" data-linenumber="21">
          <span class="hits">2592</span>
          
          <code class="ruby">      return length if @is_horizontal</code>
        </li>
      
        <li class="covered" data-hits="1458" data-linenumber="22">
          <span class="hits">1458</span>
          
          <code class="ruby">      return 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="cd17ee7063dc42529d0f17324dc96eeb1ba1243f">
  <div class="header">
    <h3>lib/bin_packing_2d/options.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>13</b> relevant lines. 
      <span class="green"><b>13</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Ladb::OpenCutList::BinPacking2D</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  class Options &lt; Packing2D</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_accessor :base_bin_length, :base_bin_width, :rotatable, :saw_kerf, :trimming, :stacking, :break_stacking_if_needed, :bbox_optimization, :presort</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize()</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="8">
          <span class="hits">6</span>
          
          <code class="ruby">      @base_bin_length = 0.0</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="9">
          <span class="hits">6</span>
          
          <code class="ruby">      @base_bin_width = 0.0</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="10">
          <span class="hits">6</span>
          
          <code class="ruby">      @rotatable = false</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="11">
          <span class="hits">6</span>
          
          <code class="ruby">      @saw_kerf = 0.0</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="12">
          <span class="hits">6</span>
          
          <code class="ruby">      @trimming = 0.0</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="13">
          <span class="hits">6</span>
          
          <code class="ruby">      @stacking = STACKING_NONE</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="14">
          <span class="hits">6</span>
          
          <code class="ruby">      @break_stacking_if_needed = true</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="15">
          <span class="hits">6</span>
          
          <code class="ruby">      @bbox_optimization = BBOX_OPTIMIZATION_NONE</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="16">
          <span class="hits">6</span>
          
          <code class="ruby">      @presort = PRESORT_INPUT_ORDER</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="7a1213086749013bea73b81b1da88cc434f77a0e">
  <div class="header">
    <h3>lib/bin_packing_2d/packengine.rb</h3>
    <h4><span class="green">98.0 %</span> covered</h4>
    <div>
      <b>50</b> relevant lines. 
      <span class="green"><b>49</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Ladb::OpenCutList::BinPacking2D</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  require_relative &#39;packing2d&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  require_relative &#39;box&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  require_relative &#39;bin&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  require_relative &#39;cut&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  require_relative &#39;score&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  require_relative &#39;performance&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  require_relative &#39;packer&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  require_relative &#39;options&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  class PackEngine &lt; Packing2D</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(options)</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="15">
          <span class="hits">21</span>
          
          <code class="ruby">      @options = options</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="16">
          <span class="hits">21</span>
          
          <code class="ruby">      @bins = []</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="17">
          <span class="hits">21</span>
          
          <code class="ruby">      @boxes = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    def add_bin(length, width, type = BIN_TYPE_USER_DEFINED)</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="21">
          <span class="hits">21</span>
          
          <code class="ruby">      @bins &lt;&lt; Bin.new(length, width, 0, 0, 0, type)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    def add_box(length, width, data = nil)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="25">
          <span class="hits">34</span>
          
          <code class="ruby">      @boxes &lt;&lt; Box.new(length, width, data)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">    def run</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">      # Check bins definitions</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="31">
          <span class="hits">21</span>
          
          <code class="ruby">      if (@options.base_bin_length == 0 or @options.base_bin_width == 0) and @bins.empty?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="32">
          <span class="hits">2</span>
          
          <code class="ruby">        return nil, ERROR_NO_BIN</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      # Compute index on each bin</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="36">
          <span class="hits">40</span>
          
          <code class="ruby">      @bins.each_with_index { |bin, i| bin.index = i } unless @bins.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="38">
          <span class="hits">19</span>
          
          <code class="ruby">      packings = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="40">
          <span class="hits">19</span>
          
          <code class="ruby">      (SCORE_BESTAREA_FIT..SCORE_WORSTLONGSIDE_FIT).to_a.each do |score|</code>
        </li>
      
        <li class="covered" data-hits="114" data-linenumber="41">
          <span class="hits">114</span>
          
          <code class="ruby">        (SPLIT_SHORTERLEFTOVER_AXIS..SPLIT_LONGER_AXIS).to_a.each do |split|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="43">
          <span class="hits">684</span>
          
          <code class="ruby">          copy_boxes = []</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="44">
          <span class="hits">684</span>
          
          <code class="ruby">          unless @boxes.nil?</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="45">
          <span class="hits">684</span>
          
          <code class="ruby">            @boxes.each do |box|</code>
        </li>
      
        <li class="covered" data-hits="1224" data-linenumber="46">
          <span class="hits">1224</span>
          
          <code class="ruby">              b = box.clone</code>
        </li>
      
        <li class="covered" data-hits="1224" data-linenumber="47">
          <span class="hits">1224</span>
          
          <code class="ruby">              copy_boxes &lt;&lt; b</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="51">
          <span class="hits">684</span>
          
          <code class="ruby">          copy_bins = []</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="52">
          <span class="hits">684</span>
          
          <code class="ruby">          unless @bins.nil?</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="53">
          <span class="hits">684</span>
          
          <code class="ruby">            @bins.each do |bin|</code>
        </li>
      
        <li class="covered" data-hits="756" data-linenumber="54">
          <span class="hits">756</span>
          
          <code class="ruby">              b = bin.clone</code>
        </li>
      
        <li class="covered" data-hits="756" data-linenumber="55">
          <span class="hits">756</span>
          
          <code class="ruby">              copy_bins &lt;&lt; b</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="59">
          <span class="hits">684</span>
          
          <code class="ruby">          p = Packer.new(@options)</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="60">
          <span class="hits">684</span>
          
          <code class="ruby">          p.pack(copy_bins, copy_boxes, score, split, @options)</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="61">
          <span class="hits">684</span>
          
          <code class="ruby">          packings &lt;&lt; p</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="66">
          <span class="hits">19</span>
          
          <code class="ruby">      valid_packings = []</code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="67">
          <span class="hits">19</span>
          
          <code class="ruby">      error = ERROR_NONE</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="69">
          <span class="hits">19</span>
          
          <code class="ruby">      packings.each do |p|</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="70">
          <span class="hits">684</span>
          
          <code class="ruby">        if p.performance.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="71">
          
          
          <code class="ruby">          error = ERROR_BAD_ERROR</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="72">
          <span class="hits">684</span>
          
          <code class="ruby">        elsif p.performance.nb_boxes_packed == 0</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="73">
          <span class="hits">36</span>
          
          <code class="ruby">          error = ERROR_NO_PLACEMENT_POSSIBLE</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="648" data-linenumber="75">
          <span class="hits">648</span>
          
          <code class="ruby">          valid_packings &lt;&lt; p          </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="79">
          <span class="hits">19</span>
          
          <code class="ruby">      return nil, error unless valid_packings.length &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="81">
          <span class="hits">18</span>
          
          <code class="ruby">      packings = valid_packings.sort_by { |p|</code>
        </li>
      
        <li class="covered" data-hits="648" data-linenumber="82">
          <span class="hits">648</span>
          
          <code class="ruby">        [ p.unplaced_boxes.length, p.performance.nb_bins, 1 / (p.performance.largest_leftover_length + 0.01), 1 / (p.performance.largest_leftover_width + 0.01), p.performance.nb_leftovers ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">      }        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="85">
          <span class="hits">18</span>
          
          <code class="ruby">      return packings[0], ERROR_NONE</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="6c8c62bbed178c84f6dec3fd5539b72f1c17c046">
  <div class="header">
    <h3>lib/bin_packing_2d/packer.rb</h3>
    <h4><span class="yellow">82.93 %</span> covered</h4>
    <div>
      <b>246</b> relevant lines. 
      <span class="green"><b>204</b> lines covered</span> and
      <span class="red"><b>42</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="2" data-linenumber="1">
          <span class="hits">2</span>
          
          <code class="ruby">module Ladb::OpenCutList::BinPacking2D class Packer &lt; Packing2D</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_accessor :saw_kerf, :original_bins, :unplaced_boxes, :unused_bins, :score, :split, :performance</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(options)</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="6">
          <span class="hits">684</span>
          
          <code class="ruby">      @saw_kerf = options.saw_kerf</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="7">
          <span class="hits">684</span>
          
          <code class="ruby">      @trimsize = options.trimming</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="8">
          <span class="hits">684</span>
          
          <code class="ruby">      @rotatable = options.rotatable</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="9">
          <span class="hits">684</span>
          
          <code class="ruby">      @score = -1</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="10">
          <span class="hits">684</span>
          
          <code class="ruby">      @split = -1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="12">
          <span class="hits">684</span>
          
          <code class="ruby">      @original_bins = []</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="13">
          <span class="hits">684</span>
          
          <code class="ruby">      @unplaced_boxes = []</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="14">
          <span class="hits">684</span>
          
          <code class="ruby">      @unused_bins = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="16">
          <span class="hits">684</span>
          
          <code class="ruby">      @b_x = 0</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="17">
          <span class="hits">684</span>
          
          <code class="ruby">      @b_y = 0</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="18">
          <span class="hits">684</span>
          
          <code class="ruby">      @b_w = 0</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="19">
          <span class="hits">684</span>
          
          <code class="ruby">      @b_l = 0</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="20">
          <span class="hits">684</span>
          
          <code class="ruby">      @stacking_maxlength = 0</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="21">
          <span class="hits">684</span>
          
          <code class="ruby">      @stacking_maxwidth = 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="23">
          <span class="hits">684</span>
          
          <code class="ruby">      @performance = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    # Pack boxes in available bins with given heuristics for the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    # in placement (score) and splitting (split).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    # If stacking is desired, then preprocess/postprocess supergroups.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    def pack(bins, boxes, score, split, options)</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="31">
          <span class="hits">684</span>
          
          <code class="ruby">      s = Score.new</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="32">
          <span class="hits">684</span>
          
          <code class="ruby">      @score = score</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="33">
          <span class="hits">684</span>
          
          <code class="ruby">      @split = split</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      # remember original length/width of first bin, aka reference bin</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="36">
          <span class="hits">684</span>
          
          <code class="ruby">      @b_l = options.base_bin_length</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="37">
          <span class="hits">684</span>
          
          <code class="ruby">      @b_w = options.base_bin_width</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="38">
          <span class="hits">684</span>
          
          <code class="ruby">      @b_x = 0</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="39">
          <span class="hits">684</span>
          
          <code class="ruby">      @b_y = 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      # bins are numbered in sequence, this is the next available index</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="42">
          <span class="hits">684</span>
          
          <code class="ruby">      if bins.nil? || bins.empty?</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="43">
          <span class="hits">36</span>
          
          <code class="ruby">        next_bin_index = 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">        # make sure we have at least one panel, otherwise stacking will try to break</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">        # stacks just for fun and give suboptimal solutions</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="46">
          <span class="hits">36</span>
          
          <code class="ruby">        bins &lt;&lt; Bin.new(@b_l, @b_w, @b_x, @b_y, next_bin_index, BIN_TYPE_AUTO_GENERATED)</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="47">
          <span class="hits">36</span>
          
          <code class="ruby">        next_bin_index += 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="648" data-linenumber="49">
          <span class="hits">648</span>
          
          <code class="ruby">        bins.each do |bin|</code>
        </li>
      
        <li class="covered" data-hits="756" data-linenumber="50">
          <span class="hits">756</span>
          
          <code class="ruby">          @stacking_maxlength = bin.length unless bin.length &lt;= @stacking_maxlength</code>
        </li>
      
        <li class="covered" data-hits="756" data-linenumber="51">
          <span class="hits">756</span>
          
          <code class="ruby">          @stacking_maxwidth = bin.width unless bin.width &lt;= @stacking_maxwidth</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="648" data-linenumber="53">
          <span class="hits">648</span>
          
          <code class="ruby">        next_bin_index = bins.length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">      # keep a copy of the original bins to collect all relevant info</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="57">
          <span class="hits">684</span>
          
          <code class="ruby">      unless bins.empty?</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="58">
          <span class="hits">684</span>
          
          <code class="ruby">        bins.each do |bin|</code>
        </li>
      
        <li class="covered" data-hits="792" data-linenumber="59">
          <span class="hits">792</span>
          
          <code class="ruby">          b = bin.get_copy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">          # the original bins are not cleaned but they know about the trimming size</code>
        </li>
      
        <li class="covered" data-hits="792" data-linenumber="61">
          <span class="hits">792</span>
          
          <code class="ruby">          b.trimsize = @trimsize</code>
        </li>
      
        <li class="covered" data-hits="792" data-linenumber="62">
          <span class="hits">792</span>
          
          <code class="ruby">          b.trimmed = true</code>
        </li>
      
        <li class="covered" data-hits="792" data-linenumber="63">
          <span class="hits">792</span>
          
          <code class="ruby">          @original_bins &lt;&lt; b</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">          # trim bins, this reduces the available space</code>
        </li>
      
        <li class="covered" data-hits="792" data-linenumber="65">
          <span class="hits">792</span>
          
          <code class="ruby">          bin.trim_rough_bin(@trimsize)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">      # remove boxes that are too large to fit a single bin</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="70">
          <span class="hits">684</span>
          
          <code class="ruby">      boxes = remove_too_large_boxes(boxes, bins)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">      # preprocess supergroups</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="73">
          <span class="hits">684</span>
          
          <code class="ruby">      boxes = preprocess_supergroups(boxes, options.stacking) if options.stacking != STACKING_NONE</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">      # sort boxes width/length decreasing (other heuristics like</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">      # by decreasing area/perimeter would also be possible)</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="77">
          <span class="hits">684</span>
          
          <code class="ruby">      case options.presort</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">        when PRESORT_WIDTH_DECR</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="79">
          <span class="hits">72</span>
          
          <code class="ruby">          boxes = boxes.sort_by { |b| [b.width, b.length] }.reverse</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">        when PRESORT_LENGTH_DECR</code>
        </li>
      
        <li class="covered" data-hits="360" data-linenumber="81">
          <span class="hits">360</span>
          
          <code class="ruby">          boxes = boxes.sort_by { |b| [b.length, b.width] }.reverse</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">        when PRESORT_AREA_DECR</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="83">
          <span class="hits">72</span>
          
          <code class="ruby">          boxes = boxes.sort_by { |b| [b.width * b.length] }.reverse</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">        when PRESORT_PERIMETER_DECR</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="85">
          <span class="hits">72</span>
          
          <code class="ruby">          boxes = boxes.sort_by { |b| [b.length + b.width] }.reverse</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">        when PRESORT_INPUT_ORDER</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">          # do nothing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="89">
          
          
          <code class="ruby">          boxes = boxes.sort_by { |b| [b.width, b.length] }.reverse</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="92">
          <span class="hits">684</span>
          
          <code class="ruby">      until boxes.empty?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">        # get next box to place</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">        # alternating between big and small boxes might be an idea?</code>
        </li>
      
        <li class="covered" data-hits="1044" data-linenumber="95">
          <span class="hits">1044</span>
          
          <code class="ruby">        box = boxes.shift</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">        # find best position for given box in collection of bins</code>
        </li>
      
        <li class="covered" data-hits="1044" data-linenumber="98">
          <span class="hits">1044</span>
          
          <code class="ruby">        i, using_rotated = s.find_position_for_box(box, bins, @rotatable, @score)</code>
        </li>
      
        <li class="covered" data-hits="1044" data-linenumber="99">
          <span class="hits">1044</span>
          
          <code class="ruby">        if i == -1</code>
        </li>
      
        <li class="covered" data-hits="288" data-linenumber="100">
          <span class="hits">288</span>
          
          <code class="ruby">          if options.bbox_optimization == BBOX_OPTIMIZATION_ALWAYS</code>
        </li>
      
        <li class="covered" data-hits="216" data-linenumber="101">
          <span class="hits">216</span>
          
          <code class="ruby">            assign_leftovers_to_bins(bins, @original_bins)</code>
        </li>
      
        <li class="covered" data-hits="216" data-linenumber="102">
          <span class="hits">216</span>
          
          <code class="ruby">            postprocess_bounding_box(@original_bins, box)</code>
        </li>
      
        <li class="covered" data-hits="216" data-linenumber="103">
          <span class="hits">216</span>
          
          <code class="ruby">            bins = collect_leftovers(@original_bins)</code>
        </li>
      
        <li class="covered" data-hits="216" data-linenumber="104">
          <span class="hits">216</span>
          
          <code class="ruby">            i, using_rotated = s.find_position_for_box(box, bins, @rotatable, @score)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="288" data-linenumber="106">
          <span class="hits">288</span>
          
          <code class="ruby">          if i == -1</code>
        </li>
      
        <li class="covered" data-hits="288" data-linenumber="107">
          <span class="hits">288</span>
          
          <code class="ruby">            if options.stacking != STACKING_NONE &amp;&amp; options.break_stacking_if_needed</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">              # try to break up this box if it is a supergroup</code>
        </li>
      
        <li class="covered" data-hits="180" data-linenumber="109">
          <span class="hits">180</span>
          
          <code class="ruby">              if box.is_superbox</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="110">
          <span class="hits">72</span>
          
          <code class="ruby">                sboxes = box.break_up_supergroup</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="111">
          <span class="hits">72</span>
          
          <code class="ruby">                boxes += sboxes</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="112">
          <span class="hits">72</span>
          
          <code class="ruby">                next</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">              # FIXME in 1.5.1 it would be nice to only break up part of the superbox</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">              #if box.is_superbox</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">              #  sboxes = box.reduce_supergroup(@saw_kerf)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">              #  boxes.unshift(*sboxes) # prepend the boxes, this does not guarantee that order is preserved</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">              #  next</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">              #end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">            # only create a new bin if this box will fit into it</code>
        </li>
      
        <li class="covered" data-hits="216" data-linenumber="122">
          <span class="hits">216</span>
          
          <code class="ruby">            if box.fits_into_bin?(@b_l, @b_w, @trimsize, @rotatable)</code>
        </li>
      
        <li class="covered" data-hits="216" data-linenumber="123">
          <span class="hits">216</span>
          
          <code class="ruby">              cs = Bin.new(@b_l, @b_w, @b_x, @b_y, next_bin_index, BIN_TYPE_AUTO_GENERATED)</code>
        </li>
      
        <li class="covered" data-hits="216" data-linenumber="124">
          <span class="hits">216</span>
          
          <code class="ruby">              cs.trimsize = @trimsize</code>
        </li>
      
        <li class="covered" data-hits="216" data-linenumber="125">
          <span class="hits">216</span>
          
          <code class="ruby">              cs.trimmed = true</code>
        </li>
      
        <li class="covered" data-hits="216" data-linenumber="126">
          <span class="hits">216</span>
          
          <code class="ruby">              @original_bins &lt;&lt; cs.get_copy</code>
        </li>
      
        <li class="covered" data-hits="216" data-linenumber="127">
          <span class="hits">216</span>
          
          <code class="ruby">              cs.trim_rough_bin(@trimsize)</code>
        </li>
      
        <li class="covered" data-hits="216" data-linenumber="128">
          <span class="hits">216</span>
          
          <code class="ruby">              next_bin_index += 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">            else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">              # this will never happen if the above FIXME is not implemented, because</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">              # the superbox will have been brocken down by now</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="132">
          
          
          <code class="ruby">              if box.is_superbox</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">                #sboxes = box.break_up_supergroup()</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">                #@unplaced_boxes.unshift(*sboxes)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="135">
          
          
          <code class="ruby">                @unplaced_boxes &lt;&lt; box</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">              else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="137">
          
          
          <code class="ruby">                @unplaced_boxes &lt;&lt; box</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="139">
          
          
          <code class="ruby">              next</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="142">
          
          
          <code class="ruby">            box.rotate if using_rotated</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="143">
          
          
          <code class="ruby">            cs = bins[i]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="144">
          
          
          <code class="ruby">            bins.delete_at(i)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="756" data-linenumber="147">
          <span class="hits">756</span>
          
          <code class="ruby">          box.rotate if using_rotated</code>
        </li>
      
        <li class="covered" data-hits="756" data-linenumber="148">
          <span class="hits">756</span>
          
          <code class="ruby">          cs = bins[i]</code>
        </li>
      
        <li class="covered" data-hits="756" data-linenumber="149">
          <span class="hits">756</span>
          
          <code class="ruby">          bins.delete_at(i)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">        # the box will be placed at the top/left corner of the bin, get its index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">        # and added to the original bin</code>
        </li>
      
        <li class="covered" data-hits="972" data-linenumber="154">
          <span class="hits">972</span>
          
          <code class="ruby">        box.set_position(cs.x, cs.y)</code>
        </li>
      
        <li class="covered" data-hits="972" data-linenumber="155">
          <span class="hits">972</span>
          
          <code class="ruby">        @original_bins[cs.index].add_box(box)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">        # split horizontally first</code>
        </li>
      
        <li class="covered" data-hits="972" data-linenumber="158">
          <span class="hits">972</span>
          
          <code class="ruby">        if cs.split_horizontally_first?(box, @split)</code>
        </li>
      
        <li class="covered" data-hits="576" data-linenumber="159">
          <span class="hits">576</span>
          
          <code class="ruby">          if box.width &lt; cs.width # this will split into top (contains the box), bottom (goes to leftover)</code>
        </li>
      
        <li class="covered" data-hits="432" data-linenumber="160">
          <span class="hits">432</span>
          
          <code class="ruby">            cs, sb = cs.split_horizontally(box.width, @saw_kerf)</code>
        </li>
      
        <li class="covered" data-hits="432" data-linenumber="161">
          <span class="hits">432</span>
          
          <code class="ruby">            @original_bins[cs.index].add_cut(Cut.new(cs.x, cs.y + box.width, cs.length, true))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">            # leftover returns to bins</code>
        </li>
      
        <li class="covered" data-hits="432" data-linenumber="163">
          <span class="hits">432</span>
          
          <code class="ruby">            bins &lt;&lt; sb</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="576" data-linenumber="165">
          <span class="hits">576</span>
          
          <code class="ruby">          if box.length &lt; cs.length # this will split into left (the box), right (goes to leftover)</code>
        </li>
      
        <li class="covered" data-hits="486" data-linenumber="166">
          <span class="hits">486</span>
          
          <code class="ruby">            cs, sr = cs.split_vertically(box.length, @saw_kerf)</code>
        </li>
      
        <li class="covered" data-hits="486" data-linenumber="167">
          <span class="hits">486</span>
          
          <code class="ruby">            @original_bins[cs.index].add_cut(Cut.new(cs.x + box.length, cs.y, cs.width, false))</code>
        </li>
      
        <li class="covered" data-hits="486" data-linenumber="168">
          <span class="hits">486</span>
          
          <code class="ruby">            bins &lt;&lt; sr</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="396" data-linenumber="171">
          <span class="hits">396</span>
          
          <code class="ruby">          if box.length &lt; cs.length # this will split into left (containes the box), right (goes to leftover)</code>
        </li>
      
        <li class="covered" data-hits="396" data-linenumber="172">
          <span class="hits">396</span>
          
          <code class="ruby">            cs, sr = cs.split_vertically(box.length, @saw_kerf)</code>
        </li>
      
        <li class="covered" data-hits="396" data-linenumber="173">
          <span class="hits">396</span>
          
          <code class="ruby">            @original_bins[cs.index].add_cut(Cut.new(cs.x + box.length, cs.y, cs.width, false))</code>
        </li>
      
        <li class="covered" data-hits="396" data-linenumber="174">
          <span class="hits">396</span>
          
          <code class="ruby">            bins &lt;&lt; sr</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="396" data-linenumber="176">
          <span class="hits">396</span>
          
          <code class="ruby">          if box.width &lt; cs.width # this will split into top (the box), bottom (goes to leftover)</code>
        </li>
      
        <li class="covered" data-hits="378" data-linenumber="177">
          <span class="hits">378</span>
          
          <code class="ruby">            cs, sb = cs.split_horizontally(box.width, @saw_kerf)</code>
        </li>
      
        <li class="covered" data-hits="378" data-linenumber="178">
          <span class="hits">378</span>
          
          <code class="ruby">            @original_bins[cs.index].add_cut(Cut.new(cs.x, cs.y + box.width, cs.length, true))</code>
        </li>
      
        <li class="covered" data-hits="378" data-linenumber="179">
          <span class="hits">378</span>
          
          <code class="ruby">            bins &lt;&lt; sb</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">        # cs is the piece of bin that contains exactly the box, but is not used since the box has already been added</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby">      # postprocess supergroups: boxes in @original_bins.boxes</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="186">
          <span class="hits">684</span>
          
          <code class="ruby">      postprocess_supergroups(@original_bins, options.stacking) if options.stacking != STACKING_NONE</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">      # assign leftovers to the original bins, here mainly for drawing purpose</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="189">
          <span class="hits">684</span>
          
          <code class="ruby">      assign_leftovers_to_bins(bins, @original_bins)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">      # compute the bounding box and fix bottom and right leftovers</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="192">
          <span class="hits">684</span>
          
          <code class="ruby">      postprocess_bounding_box(@original_bins) if options.bbox_optimization != BBOX_OPTIMIZATION_NONE</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">      # unpacked boxes are in @unpacked_boxes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="196">
          <span class="hits">684</span>
          
          <code class="ruby">      @performance = get_performance</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">    # Preprocess boxes by turning them into supergroups, that is</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">    # into length or width stripes of identical boxes up to the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">    # maximum length of the standard bin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">    def preprocess_supergroups(boxes, stacking)</code>
        </li>
      
        <li class="covered" data-hits="540" data-linenumber="206">
          <span class="hits">540</span>
          
          <code class="ruby">      sboxes = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="540" data-linenumber="208">
          <span class="hits">540</span>
          
          <code class="ruby">      if stacking == STACKING_LENGTH</code>
        </li>
      
        <li class="covered" data-hits="504" data-linenumber="209">
          <span class="hits">504</span>
          
          <code class="ruby">        maxlength = [(@b_l - 2 * @trimsize).abs, (@stacking_maxlength - 2 * @trimsize).abs].max</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">        # compute groups of same width and stack them lengthwise</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby">        # up to maxlength</code>
        </li>
      
        <li class="covered" data-hits="1260" data-linenumber="212">
          <span class="hits">1260</span>
          
          <code class="ruby">        width_groups = boxes.group_by { |b| [b.width] }</code>
        </li>
      
        <li class="covered" data-hits="504" data-linenumber="213">
          <span class="hits">504</span>
          
          <code class="ruby">        width_groups.each do |k, v|</code>
        </li>
      
        <li class="covered" data-hits="468" data-linenumber="214">
          <span class="hits">468</span>
          
          <code class="ruby">          if v.length() &gt; 1</code>
        </li>
      
        <li class="covered" data-hits="864" data-linenumber="215">
          <span class="hits">864</span>
          
          <code class="ruby">            v = v.sort_by { |b| [b.length] }.reverse</code>
        </li>
      
        <li class="covered" data-hits="288" data-linenumber="216">
          <span class="hits">288</span>
          
          <code class="ruby">            superbox = Box.new(0, k[0])</code>
        </li>
      
        <li class="covered" data-hits="288" data-linenumber="217">
          <span class="hits">288</span>
          
          <code class="ruby">            until v.empty?</code>
        </li>
      
        <li class="covered" data-hits="576" data-linenumber="218">
          <span class="hits">576</span>
          
          <code class="ruby">              box = v.shift</code>
        </li>
      
        <li class="covered" data-hits="576" data-linenumber="219">
          <span class="hits">576</span>
          
          <code class="ruby">              if box.length &lt;= maxlength</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">                # try to stack it, if it fails</code>
        </li>
      
        <li class="covered" data-hits="576" data-linenumber="221">
          <span class="hits">576</span>
          
          <code class="ruby">                if !superbox.stack_length(box, @saw_kerf, maxlength)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby">                  # close this superbox</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="223">
          
          
          <code class="ruby">                  sboxes &lt;&lt; superbox</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby">                  # and create a new one</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="225">
          
          
          <code class="ruby">                  superbox = Box.new(0, k[0])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="226">
          
          
          <code class="ruby">                  # this should alway succeed, because box.length &lt;= maxlength</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="227">
          
          
          <code class="ruby">                  superbox.stack_length(box, @saw_kerf, maxlength)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="229">
          
          
          <code class="ruby">              else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="230">
          
          
          <code class="ruby">                # box is larger than the maxlength to stack, let packer handle it</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="231">
          
          
          <code class="ruby">                sboxes &lt;&lt; box</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">            # close the last superbox created if it is not empty</code>
        </li>
      
        <li class="covered" data-hits="288" data-linenumber="235">
          <span class="hits">288</span>
          
          <code class="ruby">            if superbox.sboxes.length() &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="288" data-linenumber="236">
          <span class="hits">288</span>
          
          <code class="ruby">              sboxes &lt;&lt; superbox</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="237">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby">           else</code>
        </li>
      
        <li class="covered" data-hits="180" data-linenumber="239">
          <span class="hits">180</span>
          
          <code class="ruby">            sboxes &lt;&lt; v[0]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="240">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="243">
          <span class="hits">36</span>
          
          <code class="ruby">        maxwidth = [(@b_w - 2 * @trimsize).abs, (@stacking_maxwidth - 2 * @trimsize).abs].max</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby">        # make groups of same length and stack them widthwise</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="245">
          
          
          <code class="ruby">        # up to maxwidth</code>
        </li>
      
        <li class="covered" data-hits="108" data-linenumber="246">
          <span class="hits">108</span>
          
          <code class="ruby">        length_groups = boxes.group_by { |b| [b.length] }</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="247">
          <span class="hits">36</span>
          
          <code class="ruby">        length_groups.each do |k, v|</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="248">
          <span class="hits">36</span>
          
          <code class="ruby">          if v.length() &gt; 1</code>
        </li>
      
        <li class="covered" data-hits="108" data-linenumber="249">
          <span class="hits">108</span>
          
          <code class="ruby">            v = v.sort_by { |b| [b.width] }.reverse</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="250">
          <span class="hits">36</span>
          
          <code class="ruby">            superbox = Box.new(k[0], 0)</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="251">
          <span class="hits">36</span>
          
          <code class="ruby">            until v.empty?</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="252">
          <span class="hits">72</span>
          
          <code class="ruby">              box = v.shift</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="253">
          <span class="hits">72</span>
          
          <code class="ruby">                if box.width &lt;= maxwidth</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="254">
          <span class="hits">72</span>
          
          <code class="ruby">                  if !superbox.stack_width(box, @saw_kerf, maxwidth)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="255">
          
          
          <code class="ruby">                    sboxes &lt;&lt; superbox</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="256">
          
          
          <code class="ruby">                    superbox = Box.new(k[0], 0)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="257">
          
          
          <code class="ruby">                    superbox.stack_width(box, @saw_kerf, maxwidth)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="259">
          
          
          <code class="ruby">                else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="260">
          
          
          <code class="ruby">                  sboxes &lt;&lt; box</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="261">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="262">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="263">
          <span class="hits">36</span>
          
          <code class="ruby">              if superbox.sboxes.length() &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="264">
          <span class="hits">36</span>
          
          <code class="ruby">                sboxes &lt;&lt; superbox</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">           else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="267">
          
          
          <code class="ruby">            sboxes &lt;&lt; v[0]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="268">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="269">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="270">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="540" data-linenumber="271">
          <span class="hits">540</span>
          
          <code class="ruby">      return sboxes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="273">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="274">
          
          
          <code class="ruby">    # Postprocess supergroups by extracting the original boxes from the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="275">
          
          
          <code class="ruby">    # superboxes and adding the necessary cuts.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="276">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="277">
          
          
          <code class="ruby">    # This function will change the instance variables</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby">    # @cuts and @boxes from each bin in bins</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="280">
          <span class="hits">1</span>
          
          <code class="ruby">    def postprocess_supergroups(bins, stacking)</code>
        </li>
      
        <li class="covered" data-hits="540" data-linenumber="281">
          <span class="hits">540</span>
          
          <code class="ruby">      if stacking == STACKING_LENGTH</code>
        </li>
      
        <li class="covered" data-hits="504" data-linenumber="282">
          <span class="hits">504</span>
          
          <code class="ruby">        bins.each do |bin|</code>
        </li>
      
        <li class="covered" data-hits="648" data-linenumber="283">
          <span class="hits">648</span>
          
          <code class="ruby">          new_boxes = []</code>
        </li>
      
        <li class="covered" data-hits="648" data-linenumber="284">
          <span class="hits">648</span>
          
          <code class="ruby">          bin.boxes.each do |sbox|</code>
        </li>
      
        <li class="covered" data-hits="504" data-linenumber="285">
          <span class="hits">504</span>
          
          <code class="ruby">            if sbox.is_superbox</code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="286">
          <span class="hits">252</span>
          
          <code class="ruby">              x = sbox.x</code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="287">
          <span class="hits">252</span>
          
          <code class="ruby">              y = sbox.y</code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="288">
          <span class="hits">252</span>
          
          <code class="ruby">              cut_counts = sbox.sboxes.length() - 1</code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="289">
          <span class="hits">252</span>
          
          <code class="ruby">              sbox.sboxes.each do |b|</code>
        </li>
      
        <li class="covered" data-hits="504" data-linenumber="290">
          <span class="hits">504</span>
          
          <code class="ruby">                b.set_position(x, y)</code>
        </li>
      
        <li class="covered" data-hits="504" data-linenumber="291">
          <span class="hits">504</span>
          
          <code class="ruby">                if sbox.rotated</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="292">
          
          
          <code class="ruby">                  b.rotate</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="293">
          
          
          <code class="ruby">                  y += b.width + @saw_kerf</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="294">
          
          
          <code class="ruby">                  if cut_counts &gt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="295">
          
          
          <code class="ruby">                    bin.add_cut(Cut.new(b.x, b.y + b.width, b.length, true, false))</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="296">
          
          
          <code class="ruby">                    cut_counts = cut_counts - 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="297">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="298">
          
          
          <code class="ruby">                else</code>
        </li>
      
        <li class="covered" data-hits="504" data-linenumber="299">
          <span class="hits">504</span>
          
          <code class="ruby">                  x += b.length + @saw_kerf</code>
        </li>
      
        <li class="covered" data-hits="504" data-linenumber="300">
          <span class="hits">504</span>
          
          <code class="ruby">                  if cut_counts &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="301">
          <span class="hits">252</span>
          
          <code class="ruby">                    bin.add_cut(Cut.new(b.x + b.length, b.y, b.width, false, false))</code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="302">
          <span class="hits">252</span>
          
          <code class="ruby">                    cut_counts = cut_counts - 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="304">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="covered" data-hits="504" data-linenumber="305">
          <span class="hits">504</span>
          
          <code class="ruby">                new_boxes &lt;&lt; b</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="306">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="307">
          
          
          <code class="ruby">            else</code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="308">
          <span class="hits">252</span>
          
          <code class="ruby">              new_boxes &lt;&lt; sbox</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="309">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="310">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="648" data-linenumber="311">
          <span class="hits">648</span>
          
          <code class="ruby">          bin.boxes = new_boxes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="312">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="313">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="314">
          <span class="hits">36</span>
          
          <code class="ruby">        bins.each do |bin|</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="315">
          <span class="hits">72</span>
          
          <code class="ruby">          new_boxes = []</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="316">
          <span class="hits">72</span>
          
          <code class="ruby">          bin.boxes.each do |sbox|</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="317">
          <span class="hits">72</span>
          
          <code class="ruby">            if sbox.is_superbox</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="318">
          
          
          <code class="ruby">              x = sbox.x</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="319">
          
          
          <code class="ruby">              y = sbox.y</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="320">
          
          
          <code class="ruby">              cut_counts = sbox.sboxes.length() - 1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="321">
          
          
          <code class="ruby">              sbox.sboxes.each do |b|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="322">
          
          
          <code class="ruby">                b.set_position(x, y)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="323">
          
          
          <code class="ruby">                if sbox.rotated</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="324">
          
          
          <code class="ruby">                  b.rotate</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="325">
          
          
          <code class="ruby">                  x += b.length + @saw_kerf</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="326">
          
          
          <code class="ruby">                  if cut_counts &gt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="327">
          
          
          <code class="ruby">                    bin.add_cut(Cut.new(b.x + b.length, b.y, b.width, false, false))</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="328">
          
          
          <code class="ruby">                    cut_counts = cut_counts - 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="329">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="330">
          
          
          <code class="ruby">                else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="331">
          
          
          <code class="ruby">                  y += b.width + @saw_kerf</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="332">
          
          
          <code class="ruby">                  if cut_counts &gt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="333">
          
          
          <code class="ruby">                    bin.add_cut(Cut.new(b.x, b.y + b.width, b.length, true, false))</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="334">
          
          
          <code class="ruby">                    cut_counts = cut_counts - 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="335">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="336">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="337">
          
          
          <code class="ruby">                new_boxes &lt;&lt; b</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="338">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="339">
          
          
          <code class="ruby">            else</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="340">
          <span class="hits">72</span>
          
          <code class="ruby">              new_boxes &lt;&lt; sbox</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="341">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="342">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="343">
          <span class="hits">72</span>
          
          <code class="ruby">          bin.boxes = new_boxes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="344">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="346">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby">    # Postprocess bounding boxes because some length/width cuts may go</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby">    # through the entire bin, but are not necessary.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="350">
          
          
          <code class="ruby">    # This function trims the lower/right side of the bin by producing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="351">
          
          
          <code class="ruby">    # a longer bottom part and a shorter vertical right side part or</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="352">
          
          
          <code class="ruby">    # inversely.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="353">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="354">
          
          
          <code class="ruby">    # THIS is also a good place to remove too small boxes (&lt; 2*saw_kerf)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="355">
          
          
          <code class="ruby">    # which are really waste and not leftovers</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="356">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="357">
          <span class="hits">1</span>
          
          <code class="ruby">    def postprocess_bounding_box(bins, box = nil)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="358">
          
          
          <code class="ruby">      # box is optional and will be used to decide how to split</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="359">
          
          
          <code class="ruby">      # the bottom/right part of the bounding box, depending on a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="360">
          
          
          <code class="ruby">      # next candidate box.</code>
        </li>
      
        <li class="covered" data-hits="468" data-linenumber="361">
          <span class="hits">468</span>
          
          <code class="ruby">      bins.each do |bin|</code>
        </li>
      
        <li class="covered" data-hits="828" data-linenumber="362">
          <span class="hits">828</span>
          
          <code class="ruby">        bin.crop_to_bounding_box(@saw_kerf, box)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="363">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="365">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="366">
          
          
          <code class="ruby">    # Assign leftovers to original bins.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="367">
          
          
          <code class="ruby">    # This function will be called at least once at the end of packing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="368">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">    def assign_leftovers_to_bins(bins, original_bins)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="370">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="371">
          
          
          <code class="ruby">      # add the leftovers (bin in bins) to the parent bin, but only if</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="372">
          
          
          <code class="ruby">      # they are larger and longer than the saw_kerf</code>
        </li>
      
        <li class="covered" data-hits="900" data-linenumber="373">
          <span class="hits">900</span>
          
          <code class="ruby">      original_bins.each_with_index do |bin, index|</code>
        </li>
      
        <li class="covered" data-hits="1332" data-linenumber="374">
          <span class="hits">1332</span>
          
          <code class="ruby">        bin.leftovers = []</code>
        </li>
      
        <li class="covered" data-hits="1332" data-linenumber="375">
          <span class="hits">1332</span>
          
          <code class="ruby">        bins.each do |b|</code>
        </li>
      
        <li class="covered" data-hits="3420" data-linenumber="376">
          <span class="hits">3420</span>
          
          <code class="ruby">          if b.index == index &amp;&amp; b.width &gt;= saw_kerf &amp;&amp; b.length &gt;= saw_kerf</code>
        </li>
      
        <li class="covered" data-hits="2088" data-linenumber="377">
          <span class="hits">2088</span>
          
          <code class="ruby">            bin.leftovers &lt;&lt; b</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="380">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="382">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="383">
          
          
          <code class="ruby">    # Collect leftovers from all original bins and return them</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="384">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">    def collect_leftovers(original_bins)</code>
        </li>
      
        <li class="covered" data-hits="216" data-linenumber="386">
          <span class="hits">216</span>
          
          <code class="ruby">      leftovers = []</code>
        </li>
      
        <li class="covered" data-hits="216" data-linenumber="387">
          <span class="hits">216</span>
          
          <code class="ruby">      original_bins.each do |bin|</code>
        </li>
      
        <li class="covered" data-hits="324" data-linenumber="388">
          <span class="hits">324</span>
          
          <code class="ruby">        leftovers += bin.leftovers</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="389">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="216" data-linenumber="390">
          <span class="hits">216</span>
          
          <code class="ruby">      return leftovers</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="391">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="392">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="393">
          
          
          <code class="ruby">    # Remove boxes that are too large to fit the available bins</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="394">
          
          
          <code class="ruby">    # If a box only fits rotated, rotate it</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="395">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="396">
          <span class="hits">1</span>
          
          <code class="ruby">    def remove_too_large_boxes(boxes, bins)</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="397">
          <span class="hits">684</span>
          
          <code class="ruby">      standard_bin = Bin.new(@b_l, @b_w, 0, 0, 0, BIN_TYPE_AUTO_GENERATED)</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="398">
          <span class="hits">684</span>
          
          <code class="ruby">      boxes_that_fit = []</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="399">
          <span class="hits">684</span>
          
          <code class="ruby">      boxes.each_with_index do |box, i|</code>
        </li>
      
        <li class="covered" data-hits="1224" data-linenumber="400">
          <span class="hits">1224</span>
          
          <code class="ruby">        box_fits = false</code>
        </li>
      
        <li class="covered" data-hits="1224" data-linenumber="401">
          <span class="hits">1224</span>
          
          <code class="ruby">        bins.each do |bin|</code>
        </li>
      
        <li class="covered" data-hits="1440" data-linenumber="402">
          <span class="hits">1440</span>
          
          <code class="ruby">          if bin.encloses?(box)</code>
        </li>
      
        <li class="covered" data-hits="900" data-linenumber="403">
          <span class="hits">900</span>
          
          <code class="ruby">            box_fits = true</code>
        </li>
      
        <li class="covered" data-hits="540" data-linenumber="404">
          <span class="hits">540</span>
          
          <code class="ruby">          elsif (@rotatable &amp;&amp; bin.encloses_rotated?(box))</code>
        </li>
      
        <li class="covered" data-hits="144" data-linenumber="405">
          <span class="hits">144</span>
          
          <code class="ruby">            box.rotate</code>
        </li>
      
        <li class="covered" data-hits="144" data-linenumber="406">
          <span class="hits">144</span>
          
          <code class="ruby">            box_fits = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="408">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1224" data-linenumber="409">
          <span class="hits">1224</span>
          
          <code class="ruby">        if box_fits</code>
        </li>
      
        <li class="covered" data-hits="1044" data-linenumber="410">
          <span class="hits">1044</span>
          
          <code class="ruby">          boxes_that_fit &lt;&lt; box</code>
        </li>
      
        <li class="covered" data-hits="180" data-linenumber="411">
          <span class="hits">180</span>
          
          <code class="ruby">        elsif standard_bin.encloses?(box)</code>
        </li>
      
        <li class="covered" data-hits="180" data-linenumber="412">
          <span class="hits">180</span>
          
          <code class="ruby">          boxes_that_fit &lt;&lt; box</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="413">
          
          
          <code class="ruby">        elsif (@rotatable &amp;&amp; standard_bin.encloses_rotated?(box))</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="414">
          
          
          <code class="ruby">          box.rotate</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="415">
          
          
          <code class="ruby">          boxes_that_fit &lt;&lt; box</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="416">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="417">
          
          
          <code class="ruby">          @unplaced_boxes &lt;&lt; box</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="418">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="419">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="420">
          <span class="hits">684</span>
          
          <code class="ruby">      return boxes_that_fit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="421">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="422">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="423">
          
          
          <code class="ruby">    # Compute some statistics that will be stored in the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="424">
          
          
          <code class="ruby">    # performance object</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="425">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="426">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_performance</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="427">
          <span class="hits">684</span>
          
          <code class="ruby">      largest_bin = nil</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="428">
          <span class="hits">684</span>
          
          <code class="ruby">      largest_area = 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="429">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="430">
          <span class="hits">684</span>
          
          <code class="ruby">      p = Performance.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="431">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="432">
          <span class="hits">684</span>
          
          <code class="ruby">      bins = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="433">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="434">
          
          
          <code class="ruby">      # we split the bins into ones that contain boxes and ones</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="435">
          
          
          <code class="ruby">      # that do not contain boxes</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="436">
          <span class="hits">684</span>
          
          <code class="ruby">      @original_bins.each do |bin|</code>
        </li>
      
        <li class="covered" data-hits="1008" data-linenumber="437">
          <span class="hits">1008</span>
          
          <code class="ruby">        if bin.boxes.empty? # a bin without boxes has not been used</code>
        </li>
      
        <li class="covered" data-hits="288" data-linenumber="438">
          <span class="hits">288</span>
          
          <code class="ruby">          @unused_bins &lt;&lt; bin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="439">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="720" data-linenumber="440">
          <span class="hits">720</span>
          
          <code class="ruby">          p.nb_boxes_packed += bin.boxes.length</code>
        </li>
      
        <li class="covered" data-hits="720" data-linenumber="441">
          <span class="hits">720</span>
          
          <code class="ruby">          p.nb_leftovers += bin.leftovers.length</code>
        </li>
      
        <li class="covered" data-hits="720" data-linenumber="442">
          <span class="hits">720</span>
          
          <code class="ruby">          bin.total_cutlengths</code>
        </li>
      
        <li class="covered" data-hits="720" data-linenumber="443">
          <span class="hits">720</span>
          
          <code class="ruby">          bin.leftovers.each do |b|</code>
        </li>
      
        <li class="covered" data-hits="1404" data-linenumber="444">
          <span class="hits">1404</span>
          
          <code class="ruby">            a = b.area</code>
        </li>
      
        <li class="covered" data-hits="1404" data-linenumber="445">
          <span class="hits">1404</span>
          
          <code class="ruby">            if a &gt; largest_area</code>
        </li>
      
        <li class="covered" data-hits="846" data-linenumber="446">
          <span class="hits">846</span>
          
          <code class="ruby">              largest_bin = b</code>
        </li>
      
        <li class="covered" data-hits="846" data-linenumber="447">
          <span class="hits">846</span>
          
          <code class="ruby">              largest_area = a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="448">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="449">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="720" data-linenumber="450">
          <span class="hits">720</span>
          
          <code class="ruby">          bin.compute_efficiency</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="451">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="720" data-linenumber="452">
          <span class="hits">720</span>
          
          <code class="ruby">          bins &lt;&lt; bin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="453">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="454">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="455">
          <span class="hits">684</span>
          
          <code class="ruby">      @original_bins = bins</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="456">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="457">
          <span class="hits">684</span>
          
          <code class="ruby">      p.largest_leftover_length = largest_bin.length unless largest_bin.nil?</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="458">
          <span class="hits">684</span>
          
          <code class="ruby">      p.largest_leftover_width = largest_bin.width unless largest_bin.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="459">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="460">
          <span class="hits">684</span>
          
          <code class="ruby">      p.nb_bins = @original_bins.length</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="461">
          <span class="hits">684</span>
          
          <code class="ruby">      return p</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="462">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="463">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="464">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="465">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="466">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="d1cab849a47dbfae94082aaede1f7fdf9beefaa9">
  <div class="header">
    <h3>lib/bin_packing_2d/packing2d.rb</h3>
    <h4><span class="red">66.04 %</span> covered</h4>
    <div>
      <b>53</b> relevant lines. 
      <span class="green"><b>35</b> lines covered</span> and
      <span class="red"><b>18</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Ladb::OpenCutList</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  module BinPacking2D</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    PRESORT_INPUT_ORDER = 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    PRESORT_WIDTH_DECR = 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    PRESORT_LENGTH_DECR = 2</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    PRESORT_AREA_DECR = 3</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    PRESORT_PERIMETER_DECR = 4</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    STACKING_NONE = 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    STACKING_LENGTH = 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    STACKING_WIDTH = 2</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    BBOX_OPTIMIZATION_NONE = 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    BBOX_OPTIMIZATION_ONLY_FINAL = 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    BBOX_OPTIMIZATION_ALWAYS = 2</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">    SCORE_BESTAREA_FIT = 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    SCORE_BESTSHORTSIDE_FIT = 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    SCORE_BESTLONGSIDE_FIT = 2</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    SCORE_WORSTAREA_FIT = 3</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    SCORE_WORSTSHORTSIDE_FIT = 4</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    SCORE_WORSTLONGSIDE_FIT = 5</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">    SPLIT_SHORTERLEFTOVER_AXIS = 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    SPLIT_LONGERLEFTOVER_AXIS = 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">    SPLIT_MINIMIZE_AREA = 2</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">    SPLIT_MAXIMIZE_AREA = 3</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    SPLIT_SHORTER_AXIS = 4</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">    SPLIT_LONGER_AXIS = 5</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    BIN_TYPE_AUTO_GENERATED  = 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">    BIN_TYPE_USER_DEFINED = 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">    ERROR_NONE = 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">    ERROR_NO_BIN = 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">    ERROR_NO_PLACEMENT_POSSIBLE = 2</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    ERROR_BAD_ERROR = 3</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">    class Packing2D</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">      def self.valid_presort(presort)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">        if presort</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">          i_presort = presort.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">          if i_presort &lt; PRESORT_INPUT_ORDER or i_presort &gt; PRESORT_PERIMETER_DECR</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">            PRESORT_INPUT_ORDER</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">          i_presort</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">          PRESORT_INPUT_ORDER</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">      def self.valid_stacking(stacking)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="56">
          
          
          <code class="ruby">        if stacking</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">          i_stacking = stacking.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">          if i_stacking &lt; STACKING_NONE or i_stacking &gt; STACKING_WIDTH</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">            STACKING_NONE</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">          i_stacking</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="63">
          
          
          <code class="ruby">          STACKING_NONE</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">      def self.valid_bbox_optimization(bbox_optimization)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="68">
          
          
          <code class="ruby">        if bbox_optimization</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="69">
          
          
          <code class="ruby">          i_bbox_optimization = bbox_optimization.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="70">
          
          
          <code class="ruby">          if i_bbox_optimization &lt; BBOX_OPTIMIZATION_NONE or i_bbox_optimization &gt; BBOX_OPTIMIZATION_ALWAYS</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="71">
          
          
          <code class="ruby">            BBOX_OPTIMIZATION_NONE</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="73">
          
          
          <code class="ruby">          i_bbox_optimization</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="75">
          
          
          <code class="ruby">          BBOX_OPTIMIZATION_NONE</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="f5a1707d56acd81036d89b2859dcd98f6b3a78ab">
  <div class="header">
    <h3>lib/bin_packing_2d/performance.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Ladb::OpenCutList::BinPacking2D</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  class Performance &lt; Packing2D</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_accessor :largest_leftover_length, :largest_leftover_width, :nb_bins, :nb_boxes_packed, :nb_leftovers</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize()</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="8">
          <span class="hits">684</span>
          
          <code class="ruby">      @largest_leftover_length = 0</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="9">
          <span class="hits">684</span>
          
          <code class="ruby">      @largest_leftover_width = 0</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="10">
          <span class="hits">684</span>
          
          <code class="ruby">      @nb_bins = 0</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="11">
          <span class="hits">684</span>
          
          <code class="ruby">      @nb_boxes_packed = 0</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="12">
          <span class="hits">684</span>
          
          <code class="ruby">      @nb_leftovers = 0</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="13">
          <span class="hits">684</span>
          
          <code class="ruby">      @packing_quality = 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="b8afc62a37a01fcc46368eb0f3e0c8d4b9529fbf">
  <div class="header">
    <h3>lib/bin_packing_2d/score.rb</h3>
    <h4><span class="green">90.48 %</span> covered</h4>
    <div>
      <b>63</b> relevant lines. 
      <span class="green"><b>57</b> lines covered</span> and
      <span class="red"><b>6</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Ladb::OpenCutList::BinPacking2D</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  class Score &lt; Packing2D</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    # this may not be a good idea, verify please!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    MAX_INT = (2 ** (0.size * 8 - 2) - 1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    MATCH_PERFECT = 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    MATCH_PERFECT_R = 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    MATCH_W_OR_L = 2</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    MATCH_W_OR_L_R = 3</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    MATCH_INSIDE = 4</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    NO_MATCH = 5</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    # Compute score by heuristic. The lower the score the better the fit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    def score_by_heuristic(box, bin, score)</code>
        </li>
      
        <li class="covered" data-hits="1917" data-linenumber="18">
          <span class="hits">1917</span>
          
          <code class="ruby">      case score</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">        when SCORE_BESTAREA_FIT</code>
        </li>
      
        <li class="covered" data-hits="426" data-linenumber="20">
          <span class="hits">426</span>
          
          <code class="ruby">          return bin.length * bin.width - box.length * box.width</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">        when SCORE_BESTSHORTSIDE_FIT</code>
        </li>
      
        <li class="covered" data-hits="426" data-linenumber="22">
          <span class="hits">426</span>
          
          <code class="ruby">          return [(bin.length - box.length).abs, (bin.width - box.width).abs].min</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">        when SCORE_BESTLONGSIDE_FIT</code>
        </li>
      
        <li class="covered" data-hits="426" data-linenumber="24">
          <span class="hits">426</span>
          
          <code class="ruby">          return [(bin.length - box.length).abs, (bin.width - box.width).abs].max</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">        when SCORE_WORSTAREA_FIT</code>
        </li>
      
        <li class="covered" data-hits="213" data-linenumber="26">
          <span class="hits">213</span>
          
          <code class="ruby">          return -score_by_heuristic(box, bin, SCORE_BESTAREA_FIT)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">        when SCORE_WORSTSHORTSIDE_FIT</code>
        </li>
      
        <li class="covered" data-hits="213" data-linenumber="28">
          <span class="hits">213</span>
          
          <code class="ruby">          return -score_by_heuristic(box, bin, SCORE_BESTSHORTSIDE_FIT)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">        when SCORE_WORSTLONGSIDE_FIT</code>
        </li>
      
        <li class="covered" data-hits="213" data-linenumber="30">
          <span class="hits">213</span>
          
          <code class="ruby">          return -score_by_heuristic(box, bin, SCORE_BESTLONGSIDE_FIT)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    # Given a box, find the best suited bin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">    def find_position_for_box(box, bins, rotatable, score)</code>
        </li>
      
        <li class="covered" data-hits="1260" data-linenumber="37">
          <span class="hits">1260</span>
          
          <code class="ruby">      scores = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1260" data-linenumber="39">
          <span class="hits">1260</span>
          
          <code class="ruby">      return [-1, 0, 0, false] if bins.empty?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1260" data-linenumber="41">
          <span class="hits">1260</span>
          
          <code class="ruby">      bins.each_with_index do |bin, index|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2268" data-linenumber="43">
          <span class="hits">2268</span>
          
          <code class="ruby">        r1 = MAX_INT</code>
        </li>
      
        <li class="covered" data-hits="2268" data-linenumber="44">
          <span class="hits">2268</span>
          
          <code class="ruby">        r2 = MAX_INT</code>
        </li>
      
        <li class="covered" data-hits="2268" data-linenumber="45">
          <span class="hits">2268</span>
          
          <code class="ruby">        match_score = NO_MATCH</code>
        </li>
      
        <li class="covered" data-hits="2268" data-linenumber="46">
          <span class="hits">2268</span>
          
          <code class="ruby">        match_rotated = false</code>
        </li>
      
        <li class="covered" data-hits="2268" data-linenumber="47">
          <span class="hits">2268</span>
          
          <code class="ruby">        match = false</code>
        </li>
      
        <li class="covered" data-hits="2268" data-linenumber="48">
          <span class="hits">2268</span>
          
          <code class="ruby">        s = [-1, r1, match_score, false]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2268" data-linenumber="50">
          <span class="hits">2268</span>
          
          <code class="ruby">        if bin.encloses?(box)</code>
        </li>
      
        <li class="covered" data-hits="936" data-linenumber="51">
          <span class="hits">936</span>
          
          <code class="ruby">          match = true</code>
        </li>
      
        <li class="covered" data-hits="936" data-linenumber="52">
          <span class="hits">936</span>
          
          <code class="ruby">          r1 = score_by_heuristic(box, bin, score)</code>
        </li>
      
        <li class="covered" data-hits="936" data-linenumber="53">
          <span class="hits">936</span>
          
          <code class="ruby">          if box.width == bin.width &amp;&amp; box.length == bin.length</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">            match_score = MATCH_PERFECT</code>
        </li>
      
        <li class="covered" data-hits="936" data-linenumber="55">
          <span class="hits">936</span>
          
          <code class="ruby">          elsif box.width == bin.width || box.length == bin.length</code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="56">
          <span class="hits">252</span>
          
          <code class="ruby">            match_score = MATCH_W_OR_L</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="684" data-linenumber="58">
          <span class="hits">684</span>
          
          <code class="ruby">            match_score = MATCH_INSIDE</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="936" data-linenumber="60">
          <span class="hits">936</span>
          
          <code class="ruby">          s1 = [index, r1, match_score, false]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="2268" data-linenumber="62">
          <span class="hits">2268</span>
          
          <code class="ruby">        if rotatable &amp;&amp; bin.encloses_rotated?(box)</code>
        </li>
      
        <li class="covered" data-hits="342" data-linenumber="63">
          <span class="hits">342</span>
          
          <code class="ruby">          b = box.clone</code>
        </li>
      
        <li class="covered" data-hits="342" data-linenumber="64">
          <span class="hits">342</span>
          
          <code class="ruby">          b.rotate</code>
        </li>
      
        <li class="covered" data-hits="342" data-linenumber="65">
          <span class="hits">342</span>
          
          <code class="ruby">          r2 = score_by_heuristic(b, bin, score)</code>
        </li>
      
        <li class="covered" data-hits="342" data-linenumber="66">
          <span class="hits">342</span>
          
          <code class="ruby">          match_rotated = true</code>
        </li>
      
        <li class="covered" data-hits="342" data-linenumber="67">
          <span class="hits">342</span>
          
          <code class="ruby">          if b.width == bin.width &amp;&amp; b.length == bin.length</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="68">
          
          
          <code class="ruby">            match_score = MATCH_PERFECT_R</code>
        </li>
      
        <li class="covered" data-hits="342" data-linenumber="69">
          <span class="hits">342</span>
          
          <code class="ruby">          elsif b.width == bin.width || b.length == bin.length</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="70">
          
          
          <code class="ruby">            match_score = MATCH_W_OR_L_R</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="342" data-linenumber="72">
          <span class="hits">342</span>
          
          <code class="ruby">            match_score = MATCH_INSIDE</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="342" data-linenumber="74">
          <span class="hits">342</span>
          
          <code class="ruby">          s2 = [index, r2, match_score, true]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">        # we have two matches not rotated and rotated, therefore we have to decide</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">        # which one is better based on the match type with lowest being better</code>
        </li>
      
        <li class="covered" data-hits="2268" data-linenumber="79">
          <span class="hits">2268</span>
          
          <code class="ruby">        if match &amp;&amp; match_rotated</code>
        </li>
      
        <li class="covered" data-hits="342" data-linenumber="80">
          <span class="hits">342</span>
          
          <code class="ruby">          if s1[2] &lt; s2[2] # match_score is strictly lower on not rotated</code>
        </li>
      
        <li class="covered" data-hits="126" data-linenumber="81">
          <span class="hits">126</span>
          
          <code class="ruby">            s = s1</code>
        </li>
      
        <li class="covered" data-hits="216" data-linenumber="82">
          <span class="hits">216</span>
          
          <code class="ruby">          elsif s1[2] == s2[2] # match_score is equal on not rotated and rotated</code>
        </li>
      
        <li class="covered" data-hits="216" data-linenumber="83">
          <span class="hits">216</span>
          
          <code class="ruby">            if s1[1] &lt;= s2[1] # score is lower or equal on not rotated</code>
        </li>
      
        <li class="covered" data-hits="156" data-linenumber="84">
          <span class="hits">156</span>
          
          <code class="ruby">              s = s1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">            else</code>
        </li>
      
        <li class="covered" data-hits="60" data-linenumber="86">
          <span class="hits">60</span>
          
          <code class="ruby">              s = s2</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="88">
          
          
          <code class="ruby">          elsif s1[2] &gt; s2[2] # match score is strictly higher on not rotated</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="89">
          
          
          <code class="ruby">            s = s2</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1926" data-linenumber="91">
          <span class="hits">1926</span>
          
          <code class="ruby">        elsif match</code>
        </li>
      
        <li class="covered" data-hits="594" data-linenumber="92">
          <span class="hits">594</span>
          
          <code class="ruby">          s = s1</code>
        </li>
      
        <li class="covered" data-hits="1332" data-linenumber="93">
          <span class="hits">1332</span>
          
          <code class="ruby">        elsif match_rotated </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="94">
          
          
          <code class="ruby">          s = s2</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="2268" data-linenumber="96">
          <span class="hits">2268</span>
          
          <code class="ruby">        scores &lt;&lt; s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">      # sort by best match score ascending, then heuristic score</code>
        </li>
      
        <li class="covered" data-hits="3528" data-linenumber="100">
          <span class="hits">3528</span>
          
          <code class="ruby">      scores = scores.sort_by { |e| [e[2], e[1]] }</code>
        </li>
      
        <li class="covered" data-hits="1260" data-linenumber="101">
          <span class="hits">1260</span>
          
          <code class="ruby">      return scores[0][0], scores[0][3]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
      </div>
    </div>
  </body>
</html>
